---
layout: post
title: <데이터베이스> 14. 레디스(Redis)
subtitle: Engineer Information Processing
author: Jo
categories: CS
banner:
  image: https://github.com/CheeseYoung/Cheeseyoung.github.io/assets/132384527/a46cc019-201d-4884-8866-c136769d5d16
  opacity: 0.618
  background: "#000"
  height: "100vh"
  min_height: "38vh"
  heading_style: "font-size: 4.25em; font-weight: bold; text-decoration: underline"
  subheading_style: "color: gold"
tags: Study

---

# 목차
🕳 DBMS / RDBMS / SQL / NoSQL <br>
📌 레디스(Redis) <br>
🕳 DB Lock <br>
🕳 클러스터링 vs 리플리케이션(Clustering vs Replication) <br>
🕳 장애와 회복기법 <br>
🕳 SQL의 종류 (DDL, DML, DCL, TCL) <br>
<br>
<hr>


## 레디스(Redis)
![image](https://github.com/CheeseYoung/Cheeseyoung.github.io/assets/132384527/a46cc019-201d-4884-8866-c136769d5d16)
# **Re**mote **Di**ctionary **S**torage
- 레디스는 빠른 오픈 소스인 메모리 키 값 데이터 구조 데이터베이스로, 일종의 NoSQL이다.
- 주요 레디스 사용 사례는 캐싱, 세션 관리, pub/sub 및 순위표를 들 수 있다.
- 레디스는 **속도가 빠르고 사용이 간편**하여 최고의 성능이 필요한 웹, 모바일, 게임, 광고 기술 및 IoT 애플리캐이션에서 사용된다. 


## 레디스의 특징 및 장점
# 1. 인 메모리 데이터베이스
- 레디스는 디스크가 아닌 **메모리 기반의 데이터 저장소**이다.
- 데이터 대부분을 디스크 또는 SSD에 저장하는 다른 데이터베이스와는 달리 모든 레디스 데이터는 서버의 주 메모리에 상주한다.
- 레디스와 같은 인 메모리 데이터 스토어는 작업을 위해 디스크까지 왕복해야 하는 단점이 없다.
- NoSQL & Cache 솔루션이며 메모리 기반으로 구성된다.
- 명시적으로 삭제를 설정하지 않으면 **데이터는 삭제되지 않는 영구적 보존**이다.
- 여러 대의 서버로 구성이 가능하며 **데이터베이스로도 사용할 수 있고, cache 서버로도 사용**할수 있다.
- 성능은 서버에 따라 다르지만 1초당 수백만건의 작업이 가능하다.
- 메모리 위에서 동작하는 레디스는 **NoSQL DBMS**로 분류되며 동시에 Memcached와 같은 **인메모리(In-memory) 솔루션**으로 분리된다.
- 데이터 저장소로 입/출력이 가장 빠른 메모리를 채택하고 **단순한 구조의 데이터 모델**을 사용하여 속도가 빠르다.
- 캐시 및 데이터 스토어에 유리하고 다양한 API를 지원한다.
- 레디스는 대형 서비스 업체들이 사용자들의 **대규모 메시지를 실시간으로 처리**하기 위해서 사용하고 있다.
- 레디스와 멤캐시드(Memcashed)는 특징이 유사하다.
![image](https://github.com/CheeseYoung/Cheeseyoung.github.io/assets/132384527/05c8557e-512a-408a-9603-5707024491d2)

# 2. 5가지형 자료구조를 지원
Redis가 지원하는 데이터 형식은 String, Set, Sorted, Hash, List가 있다.
- 다양한 자료구조를 지원하게 되면 개발의 편의성이 좋아지고 난이도가 낮아진다.
- Strings : 값에 문자, 숫자 등을 저장하고, 저장시에 별도로 숫자 문자 구분이 없다.
- Lists : 값에 리스트를 작성하며, 중복이 가능하다.
- Sets : 값을 집합 형태로 가지고 있으며, 중복이 되지 않는다.
- Hashes : key/value 목록을 값으로 가진다.
- Sorted sets : 값을 집합 형태로 가지고 있는다. 중복이 되지 않으며, 정렬이 된다는 장점이 있다.

# 3. 리스트형 데이터 입력과 삭제 성능
- 리스트, 배열과 같은 데이터를 처리하는데 유용하다.
- value 값으로 문자열, 리스트, Set, Sorted Set, Hash 등 여러 데이터 형식을 지원한다.
- 리스트형 데이터 입력과 삭제가 MySQL에 비해서 10배 정도 빠르다고 한다.

# 4. 기본-복제 아키텍처를 제공(복구기능 및 확장)
- **기본-복제 아키텍처(architecture)** 를 사용하며 **비동기식 복제를 지원**하므로 데이터가 여러 복제 서버에 복제될 수 있다.
- 주 서버에 장애가 발생하는 경우 요청이 여러 서버로 분산될 수 있음으로 향상된 읽기 성능과 **더 빠른 복구 기능을 사용**할 수 있다.
- 그리고 단일 노드 또는 클러스터링된 토폴로지에서도 기본-복제 아키텍처를 제공한다.
- 따라서 가용성이 뛰어난 솔루션을 구축하여 일관된 성능과 안정성을 사용할 수 있다.
- 클러스터 크기를 조정해야할 경우 스케일 업,인,아웃할 다양한 옵션이 있다. 따라서 수요에 맞춰 **클러스터를 확장**할 수 있다.

# 5. 메모리를 활용하면서 영속성 데이터 보존
- 스냅샷(기억장치) 기능을 제공하여 메모리의 내용을 .rdb 파일로 저장하여 해당 시점으로 복구할 수 있다.
- 즉, 명령어로 삭제,만료를 설정하지 않으면 영구적이라는 말이다.

## 레디스 단점
- 메모리를 2배 사용
- 싱글 스레드
  - 스냅샷을 뜰 때 자식 프로세스를 하나 만들어낸 후 새로 변경된 메모리 페이지를 복사해서 사용한다.
- copy-on-write 방식
  - 보통 레디스를 사용할 때는 데이터 변경이 자주 있기 때문에 실제 메모리만큼 자식 프로세스가 복사하게 해서 사용하게 된다.
  - 그러면 실제로 필요한 메모리양 보다 더 많은 메모리를 잡아먹게 된다.
- 대규모 트래픽으로 인한 속도 불안정
  - 대규모 트래픽으로 인해 많은 데이터가 업데이트되면 레디스는 Memcached에 비해서 속도가 불안정하다.
  - 이것은 레디스와 Memcached의 메모리 할당 구조가 다르기 때문에 발생하는 현상이다.
- 메모리 파편화 발생
  - jemalloc을 사용하기 때문에 매번 malloc과 free를 통해서 메모리 할당이 이루어진다.
  - 이로 인해 레디스는 메모리 파편화가 발생하여 이 할당 비용 때문에 응답 속도가 느려진다.
  - (다만 이는 극단적으로 봤을 때 발생하는 일이다.)

## 활용 부분
# 1. 캐싱 전략: Look Aside (=Lazy Loading)
![image](https://github.com/CheeseYoung/Cheeseyoung.github.io/assets/132384527/206ecdec-7a8d-41cc-b817-8fdb8f21e04d)
캐시를 옆에 두고 필요할 때만 데이터를 캐시에 로드하는 전략이다. ( key-value 형태로 저장됨 )
  1) 데이터 가져오는 요청
  2) Redis에 먼저 요청 -> 있으면 반환
  3) 없으면 데이터베이스에 데이터 요청
  4) 이 데이터를 레디스에 저장
- 레디스를 사용하면 빈번하게 요청되는 항목을 1ms 안으로 처리할 수 있으며
- 고가의 백엔드를 추가하지 않아도 손쉽게 확장하여 더 많은 로드를 처리할 수 있다.

# 2. 채팅, 메시징 및 대기열
- 레디스는 패턴 매칭과 다양한 구조 옵션으로 게시/구독을 사용할 수 있다.
- 따라서 레디스에서는 채팅방, 실시간 코멘드 스트림, 소셜 미디어 피드 및 **서버 상호 통신을 지원**한다.
- 레디스 목록 데이터 구조를 사용하면 간단한 대기열을 손쉽게 구현할 수 있다.
- 목록은 자동 작업 및 차단 기능을 제공하므로
- 신뢰할 수 있는 메시지 브로커 또는 순환 목록이 필요한 다양한 애플리케이션에 적합하다.

# 3. 다양한 미디어 스트리밍
- 레디스는 *라이브 스트리밍* 사용 사례를 지원할 수 있는 빠른 인 메모리 데이터 스토어를 제공한다.
- 레디스는 CDN(Contents Delivery Network)이 동시에 수백만 명의 모바일 및 데스크톱 사용자에게 비디오를 스트리밍할 수 있도록
- 사용자 프로필 및 열람 기록에 대한 메타데이터, 수백만 *사용자의 인증 정보/토큰, 매니페스트 파일을 저장*하는 데 사용할 수 있다.

# 4. 지리 공간
- 대규모의 실시간 지리 공간 데이터를 빠르게 관리할 수 있도록 구축된 인 메모리 데이터 구조 및 연산자를 제공한다.
- 지리 공간 데이터를 실시간으로 저장, 처리 및 분석하는 명령을 사용하면
- 레디스에서 쉽고 빠르게 지리 공간을 처리할 수 있다.
- 레디스를 사용하여 주행 시간, 주행 거리, 안내 표시와 같은 *위치 기반 기능*을 애플리케이션에 추가할 수 있다.

# 5. 실시간 분석
- 레디스는 스트리밍 솔루션에 인 메모리 데이터 스토어로 사용하여
- 1밀리초 미만의 지연 시간으로 *실시간 데이터를 수집, 처리 및 분석*할 수 있다.
- 레디스는 소셜 미디어 분석, 광고 타게팅(Targeting), 개인화 및 IoT와 같은 실시간 분석 사용 사례에 적합하다.

## 활용 사례
- 좋아요 철
- 일일 순 방문자수 구하기
- 출석 이벤트 구현하기





